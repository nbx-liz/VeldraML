============================= test session starts =============================
platform win32 -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0 -- c:\home\VeldraML\.venv\Scripts\python.exe
rootdir: C:\home\VeldraML
configfile: pyproject.toml
plugins: dash-2.18.2, cov-7.0.0
collecting ... collected 7 items

tests/test_gui_app_coverage_2.py::test_inspect_data_upload_csv PASSED    [ 14%]
tests/test_gui_app_coverage_2.py::test_inspect_data_upload_unsupported FAILED [ 28%]
tests/test_gui_app_coverage_2.py::test_detect_run_action PASSED          [ 42%]
tests/test_gui_app_coverage_2.py::test_build_config_yaml_full PASSED     [ 57%]
tests/test_gui_app_coverage_2.py::test_result_view_empty_and_error PASSED [ 71%]
tests/test_gui_app_coverage_2.py::test_evaluate_action FAILED            [ 85%]
tests/test_gui_app_coverage_2.py::test_minor_callbacks FAILED            [100%]

================================== FAILURES ===================================
____________________ test_inspect_data_upload_unsupported _____________________

mock_inspect = <MagicMock name='inspect_data' id='2097958542672'>

    @patch("veldra.gui.app.inspect_data")
    def test_inspect_data_upload_unsupported(mock_inspect):
        """Test unsupported file type."""
        upload_contents = "data:text/plain;base64,123"
>       res = _cb_inspect_data(1, "old.csv", upload_contents, "data.txt")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_gui_app_coverage_2.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\veldra\gui\app.py:481: in _cb_inspect_data
    decoded = base64.b64decode(content_string)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

s = b'123', altchars = None, validate = False

    def b64decode(s, altchars=None, validate=False):
        """Decode the Base64 encoded bytes-like object or ASCII string s.
    
        Optional altchars must be a bytes-like object or ASCII string of length 2
        which specifies the alternative alphabet used instead of the '+' and '/'
        characters.
    
        The result is returned as a bytes object.  A binascii.Error is raised if
        s is incorrectly padded.
    
        If validate is False (the default), characters that are neither in the
        normal base-64 alphabet nor the alternative alphabet are discarded prior
        to the padding check.  If validate is True, these non-alphabet characters
        in the input result in a binascii.Error.
        For more information about the strict base64 check, see:
    
        https://docs.python.org/3.11/library/binascii.html#binascii.a2b_base64
        """
        s = _bytes_from_decode_data(s)
        if altchars is not None:
            altchars = _bytes_from_decode_data(altchars)
            assert len(altchars) == 2, repr(altchars)
            s = s.translate(bytes.maketrans(altchars, b'+/'))
>       return binascii.a2b_base64(s, strict_mode=validate)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       binascii.Error: Incorrect padding

.uv_python\cpython-3.11.14-windows-x86_64-none\Lib\base64.py:88: Error
____________________________ test_evaluate_action _____________________________

mock_load = <MagicMock name='load' id='2097978511312'>
mock_data = <MagicMock name='load_tabular_data' id='2097978516624'>
mock_eval = <MagicMock name='evaluate' id='2097978521744'>

    @patch("veldra.gui.app.evaluate")
    @patch("veldra.gui.app.load_tabular_data")
    @patch("veldra.gui.app.Artifact.load")
    def test_evaluate_action(mock_load, mock_data, mock_eval):
        # Happy path
        @dataclass
        class MockResult:
            metrics: dict
            preds: pd.DataFrame
    
        mock_res = MockResult(metrics={"acc": 0.9}, preds=pd.DataFrame({"a": [1]}))
        mock_eval.return_value = mock_res
    
        res = _cb_evaluate_artifact_action(1, "art_path", "data_path")
>       assert '"metrics":' in res
E       assert '"metrics":' in 'Evaluation failed: Object of type DataFrame is not JSON serializable'

tests\test_gui_app_coverage_2.py:125: AssertionError
____________________________ test_minor_callbacks _____________________________

    def test_minor_callbacks():
        # Sync path preset
>       assert _sync_path_preset("custom", "any")[0] == "custom"
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_gui_app_coverage_2.py:137: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\veldra\gui\app.py:1008: in _sync_path_preset
    triggered = callback_context.triggered_id
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

args = (<dash._callback_context.CallbackContext object at 0x000001E8134C5B10>,)
kwargs = {}

    @functools.wraps(func)
    def assert_context(*args, **kwargs):
        if not context_value.get():
>           raise exceptions.MissingCallbackContextException(
                f"dash.callback_context.{getattr(func, '__name__')} is only available from a callback!"
            )
E           dash.exceptions.MissingCallbackContextException: dash.callback_context.triggered_id is only available from a callback!

.venv\Lib\site-packages\dash\_callback_context.py:21: MissingCallbackContextException
=========================== short test summary info ===========================
FAILED tests/test_gui_app_coverage_2.py::test_inspect_data_upload_unsupported - binascii.Error: Incorrect padding
FAILED tests/test_gui_app_coverage_2.py::test_evaluate_action - assert '"metrics":' in 'Evaluation failed: Object of type DataFrame is not JSON serializable'
FAILED tests/test_gui_app_coverage_2.py::test_minor_callbacks - dash.exceptions.MissingCallbackContextException: dash.callback_context.triggered_id is only available from a callback!
========================= 3 failed, 4 passed in 1.17s =========================
